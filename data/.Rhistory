plot(test, 90)
plot(test, 120)
plot(test, 150)
plot(test, 170)
plot(test, 180)
library(terra)
library(prism)
library(polite)
prism_dl_dir = "/Users/jonas/Library/CloudStorage/OneDrive-MontanaStateUniversity/ECNS 460/teton_nf_prism_download"
prism_set_dl_dir("/Users/jonas/Library/CloudStorage/OneDrive-MontanaStateUniversity/ECNS 460/teton_nf_prism_download")
#makes a teton NP specific version of the PRISM data for date and variable
get_raster = function(variable, date){
weather_rast = rast(paste(prism_dl_dir, "/PRISM_",variable,"_stable_4kmD2_",date,"_bil/PRISM_",variable,"_stable_4kmD2_",date,"_bil.bil", sep = ""))
weather_rast = project(weather_rast, "NAD83")
weather_rast_masked = mask(weather_rast, teton_nf_boundary)
weather_rast_masked = crop(weather_rast_masked, teton_nf_boundary)
return(weather_rast_masked)
}
make_variable_raster = function(variable, date_range){
weather_var_raster = sapply(date_range, function(x){get_raster(variable, x)})
weather_var_raster = rast(weather_var_raster)
return(weather_var_raster)
}
weather_data = sapply(weather_variables, function(x) {make_variable_raster(x, date_range)})
CRS_use = "NAD83"
weather_variables = c("tmean", "tmin", "tmax", "ppt", "tdmean", "vpdmin", "vpdmax")
start_date = as.Date("2020-01-01")
simple_start_date = format(start_date, "%Y%m%d")
end_date = as.Date("2023-12-31")
simple_end_date = format(end_date, "%Y%m%d")
date_range = seq(as.Date(start_date), as.Date(end_date), by = "day")
date_range = sapply(date_range, function(x) {format(x, "%Y%m%d")})
#This is the vector file of teton NF boundaries
teton_nf_boundary = vect("raw_data/grte_tracts/grte_boundary.shp")
setwd("/Users/jonas/Library/CloudStorage/OneDrive-MontanaStateUniversity/ECNS 460/ECNS460PROJECT/data")
#This is the vector file of teton NF boundaries
teton_nf_boundary = vect("raw_data/grte_tracts/grte_boundary.shp")
#The CRS is NAD83
CRS_use = "NAD83"
weather_variables = c("tmean", "tmin", "tmax", "ppt", "tdmean", "vpdmin", "vpdmax")
#makes a teton NP specific version of the PRISM data for date and variable
get_raster = function(variable, date){
weather_rast = rast(paste(prism_dl_dir, "/PRISM_",variable,"_stable_4kmD2_",date,"_bil/PRISM_",variable,"_stable_4kmD2_",date,"_bil.bil", sep = ""))
weather_rast = project(weather_rast, "NAD83")
weather_rast_masked = mask(weather_rast, teton_nf_boundary)
weather_rast_masked = crop(weather_rast_masked, teton_nf_boundary)
return(weather_rast_masked)
}
make_variable_raster = function(variable, date_range){
weather_var_raster = sapply(date_range, function(x){get_raster(variable, x)})
weather_var_raster = rast(weather_var_raster)
return(weather_var_raster)
}
weather_data = sapply(weather_variables, function(x) {make_variable_raster(x, date_range)})
weather_data = sds(weather_data)
writeRaster(weather_data[1], "raw_data/teton_weather_rasters/teton_tmean_raster.tif", overwrite = T)
writeRaster(weather_data[1], "raw_data/teton_weather_rasters/teton_tmean_raster.tif", overwrite = T)
writeRaster(weather_data[2], "raw_data/teton_weather_rasters/teton_tmin_raster.tif", overwrite = T)
writeRaster(weather_data[3], "raw_data/teton_weather_rasters/teton_tmax_raster.tif", overwrite = T)
writeRaster(weather_data[4], "raw_data/teton_weather_rasters/teton_ppt_raster.tif", overwrite = T)
writeRaster(weather_data[5], "raw_data/teton_weather_rasters/teton_tdmean_raster.tif", overwrite = T)
writeRaster(weather_data[6], "raw_data/teton_weather_rasters/teton_vpdmin_raster.tif", overwrite = T)
writeRaster(weather_data[7], "raw_data/teton_weather_rasters/teton_vpdmax_raster.tif", overwrite = T)
library(terra)
tmean = rast("raw_data/teton_weather_rasters/teton_tmean_raster.tif")
tmax = rast("raw_data/teton_weather_rasters/teton_tmax_raster.tif")
tmin = rast("raw_data/teton_weather_rasters/teton_tmin_raster.tif")
ppt = rast("raw_data/teton_weather_rasters/teton_ppt_raster.tif")
tdmean = rast("raw_data/teton_weather_rasters/teton_tdmean_raster.tif")
vpdmin = rast("raw_data/teton_weather_rasters/teton_vpdmin_raster.tif")
vpdmax = rast("raw_data/teton_weather_rasters/teton_vpdmax_raster.tif")
weather_data = sds(tmean, tmax, tmin, ppt, tdmean, vpdmin, vpdmax)
getwd()
read.csv2("raw_data/weather_and_avalanche_logs_f18_to_s23.csv")
avalanches = read.csv2("raw_data/weather_and_avalanche_logs_f18_to_s23.csv")
View(avalanches)
avalanches = read.csv2("raw_data/MasterAVYdata.csv")
View(avalanches)
avalanches = read.csv2("raw_data/MasterAVYdata.csv", delim = ",")
avalanches = read.csv("raw_data/MasterAVYdata.csv")
View(avalanches)
avalanches_pre = read.csv("raw_data/MasterAVYdata.csv")
library(tidyverse)
pattern = c("Lat", latitude = ".*?", "Lng:", longitude = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start")
View(avalanches)
pattern = c("Lat: ", latitude = ".*?", "Lng: ", longitude = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start")
View(avalanches)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
mutate(latitude = as.numeric(latitude), longitude = as.numeric(longitude))
View(avalanches_pre)
View(avalanches)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
mutate(latitude = as.numeric(latitude), longitude = as.numeric(longitude))
View(avalanches)
ava_locations = select(avalanches, latitude, longitude)
View(ava_locations)
extract(tmean, ava_locations)
terra::extract(tmean, ava_locations)
tmean_points = terra::extract(tmean, ava_locations)
View(tmean_points)
tmean_points = terra::extract(tmean, ava_locations, ID = F)
ava_vect = vect(avalanches, geom = c(longitude,latitude), crs = "NAD83")
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83", type = "points")
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83")
View(ava_vect)
plot(ava_vect)
plot(ava_vect, tmean[3])
extract(tmean, ava_vect)
terra::extract(tmean, ava_vect)
tmean_ava = terra::extract(tmean, ava_vect)
View(tmean_ava)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(Date),
date = format(date, "%Y%m%d"))
View(avalanches)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(Date))
View(avalanches)
View(avalanches)
View(avalanches)
View(avalanches_pre)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
rename(date = Date) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(Date))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
rename(date = Date) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date))
View(avalanches_pre)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start")
date_pattern = c(day = ".*?", "/", month = ".*?", "/", year = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start")
View(avalanches)
date_pattern = c(tday = ".*?", "/", tmonth = ".*?", "/", tyear = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste(tyear, tmonth, tday)) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste(tyear, tmonth, tday)) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude))
View(avalanches_pre)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste(tyear, tmonth, tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, tmonth, tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude))
View(avalanches_pre)
date_pattern = c(tmonth = ".*?", "/", tday = ".*?", "/", tyear = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
date = format(date, "%Y%m%d"))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"))
weather_data
lapp(weather_data, function(x) {terra::extract(x, ava_vect)})
tmean_ava = terra::extract(weather_data, ava_vect)
View(tmean_ava)
View(avalanches_pre)
View(ava_vect)
View(tmean_ava)
plot(avalanches_all_weather)
avalanches_all_weather = terra::extract(weather_data, ava_vect)
plot(avalanches_all_weather)
plot(avalanches_all_weather[1])
avalanches_all_weather[1]
avalanches_all_weather[1] |> view()
avalanches_all_weather["teton_tmean_raster"] |> view()
avalanches_all_weather["teton_tmean_raster"]$"20200101"
avalanches_all_weather["teton_tmean_raster"$"20200101"]
avalanches_all_weather["teton_tmean_raster"] |> view()
avalanches_all_weather["teton_tmean_raster.20200101"] |> view()
View(tmean_points)
View(ava_vect)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"),
date_minus30 = date - 30)
View(avalanches)
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"),
date_minus30 = date - 30,
simple_date_minus30 = format(date_minus30, "%Y%m%d")
avalanches = avalanches_pre |>
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"),
date_minus30 = date - 30,
simple_date_minus30 = format(date_minus30, "%Y%m%d"))
View(avalanches)
avalanches_all_weather = terra::extractRange(weather_data, ava_vect,
first = simple_date_minus30,
last = simple_date)
avalanches_all_weather = terra::extractRange(ppt, ava_vect,
first = simple_date_minus30,
last = simple_date)
avalanches_all_weather = terra::extract(weather_data, ava_vect)
View(avalanches_all_weather)
View(avalanches_all_weather)
avalanches_all_weather["teton_tmean_raster"] |>
view()
avalanches_all_weather = terra::extract(weather_data, ava_vect, xy = T)
avalanches_all_weather = terra::extract(weather_data, ava_vect, xy = TRUE)
avalanches_all_weather["teton_tmean_raster"] |>
view()
ava_vect = rasterize(ava_vect)
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83")
ava_vect = rasterize(ava_vect)
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83")
avalanches_all_weather = terra::extract(weather_data, ava_vect, xy = TRUE)
values(ava_vect)
values(ava_vect) |> view()
avalanches_all_weather = terra::extract(weather_data, ava_vect, xy = TRUE, values = TRUE)
avalanches_all_weather["teton_tmean_raster"] |>
view()
values(ava_vect, id = TRUE) |> view()
values(ava_vect) |> view()
values(ava_vect, ID = TRUE) |> view()
ava_vect[1]
avalanches_all_weather["teton_tmean_raster"] |>
view()
avalanches_all_weather = terra::extract(weather_data, ava_vect)
#reference one dataset in the extracted data
avalanches_all_weather["teton_tmean_raster"] |>
view()
has.time(vpdmin)
terra::time(tmean) = as.Date("2020-01-01")
terra::time(tmean) = as.Date("2020-01-01") 0:2
terra::time(tmean) = as.Date("2020-01-01", "2024-12-31")
start_date = as.Date("2020-01-01")
end_date = as.Date("2023-12-31")
date_range = seq(as.Date(start_date), as.Date(end_date), by = "day")
terra::time(tmean) = date_range
terra::time(weather_data) = date_range
View(weather_data)
has.time(tmean)
plot(tmean)
has.time(ava_vect)
avalanches_all_weather["teton_tmean_raster"] |>
view()
values(ava_vect) |> view()
terra::extract(tmean, ava_vect[1])
values(ava_vect[1]) |> view()
values(ava_vect[[tmonth]]) |> view()
values(ava_vect[tmonth]) |> view()
values(ava_vect[1]$tmonth) |> view()
ava_vect[1]$tmonth
ava_vect[1]$tmonth
ava_vect[1]
terra::extractRange(tmean, ava_vect[1]$date, first = ava_vect[1]$date_minus30)
terra::extractRange(tmean, ava_vect[1]$simple_date, first = ava_vect[1]$simple_date_minus30)
names(tmean)
terra::extractRange(tmean, as.chr(ava_vect[1]$simple_date), first = as.chr(ava_vect[1]$simple_date_minus30))
terra::extractRange(tmean, as.character(ava_vect[1]$simple_date), first = as.character(ava_vect[1]$simple_date_minus30))
terra::extractRange(tmean, ava_vect[1], first = as.character(ava_vect[1]$simple_date_minus30))
as.character(ava_vect[1]$simple_date_minus30)
terra::extractRange(tmean, ava_vect[1], first = as.character(ava_vect[1]$simple_date_minus30), last = as.character(ava_vect[1]$simple_date))
names(tmean)
ava_vect[1]$simple_date_minus30
ava_vect[100]$simple_date_minus30
terra::extractRange(tmean, ava_vect[100], first = as.character(ava_vect[100]$simple_date_minus30), last = as.character(ava_vect[100]$simple_date))
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"),
date_minus30 = date - 30,
simple_date_minus30 = format(date_minus30, "%Y%m%d"))|>
filter(date < end_date)
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83")
terra::extractRange(tmean, ava_vect, first = as.character(ava_vect$simple_date_minus30), last = as.character(ava_vect$simple_date))
View(avalanches_all_weather)
avalanches_all_weather = terra::extractRange(tmean,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))
View(avalanches_all_weather)
avalanches_all_weather[[1]]
avalanches_all_weather[[1]] |> view()
View(avalanches_all_weather)
avalanches_all_weather = terra::extractRange(weather_data,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))
weather_data = c(tmean, tmax, tmin, ppt, tdmean, vpdmin, vpdmax)
avalanches_all_weather = lapply(weather_data, function(x) {terra::extractRange(x,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))
View(avalanches_all_weather)
View(avalanches_all_weather)
weather_data = sds(tmean, tmax, tmin, ppt, tdmean, vpdmin, vpdmax)
avalanches_all_weather = rapp(weather_data, function(x) {terra::extractRange(x,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))
avalanches_all_weather = rapp(weather_data, function(x) {terra::extractRange(x,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))})
avalanches_all_weather = rapp(weather_data, function(x) {terra::extractRange(x,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))})
View(avalanches_all_weather)
View(avalanches_all_weather)
avalanches_all_weather = rapp(weather_data, function(x) {terra::extractRange(x,
ava_vect,
first = as.character(ava_vect$simple_date_minus30),
last = as.character(ava_vect$simple_date))})
avalanches_tmean =terra::extractRange(x,ava_vect,first = as.character(ava_vect$simple_date_minus30), last = as.character(ava_vect$simple_date))
library(terra)
library(tidyverse)
#Bring in weather rasters
tmean = rast("raw_data/teton_weather_rasters/teton_tmean_raster.tif")
tmax = rast("raw_data/teton_weather_rasters/teton_tmax_raster.tif")
tmin = rast("raw_data/teton_weather_rasters/teton_tmin_raster.tif")
ppt = rast("raw_data/teton_weather_rasters/teton_ppt_raster.tif")
tdmean = rast("raw_data/teton_weather_rasters/teton_tdmean_raster.tif")
vpdmin = rast("raw_data/teton_weather_rasters/teton_vpdmin_raster.tif")
vpdmax = rast("raw_data/teton_weather_rasters/teton_vpdmax_raster.tif")
#Creates a dataset of all of them together
weather_data = sds(tmean, tmax, tmin, ppt, tdmean, vpdmin, vpdmax)
#add time to raster
start_date = as.Date("2020-01-01")
end_date = as.Date("2023-12-31")
date_range = seq(as.Date(start_date), as.Date(end_date), by = "day")
terra::time(weather_data) = date_range
#Teton National Park avalanche data
avalanches_pre = read.csv("raw_data/MasterAVYdata.csv")
#needed a little bit more cleaning to be compatible----
pattern = c("Lat: ", latitude = ".*?", "Lng: ", longitude = ".*?")
date_pattern = c(tmonth = ".*?", "/", tday = ".*?", "/", tyear = ".*?")
avalanches = avalanches_pre |>
separate_wider_regex(cols = Location,
patterns = pattern,
too_few = "align_start") |>
separate_wider_regex(cols = Date,
patterns = date_pattern,
too_few = "align_start") |>
mutate(date = paste("20", tyear, "/", tmonth, "/", tday, sep = "")) |>
mutate(latitude = as.numeric(latitude),
longitude = as.numeric(longitude),
date = as.Date(date),
simple_date = format(date, "%Y%m%d"),
date_minus30 = date - 30,
simple_date_minus30 = format(date_minus30, "%Y%m%d"))|>
filter(date < end_date)
#Make points from avalanches----
#making a vector of points where avalanche observations take place
ava_vect = vect(avalanches, geom = c("longitude", "latitude"), crs = "NAD83")
avalanches_tmean =terra::extractRange(x,ava_vect,first = as.character(ava_vect$simple_date_minus30), last = as.character(ava_vect$simple_date))
#test
